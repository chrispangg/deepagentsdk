---
date: 2025-01-11 10:30:00 AEDT
context: Phase 1-4: Implementing E2B, Modal, Runloop, Daytona backends
---

# Implementation Notes - SDK API Differences

## Issues Discovered

### 1. UploadFiles/DownloadFiles Not Part of Protocol
**Finding**: The `SandboxBackendProtocol` interface only requires `execute` and `id`. The `uploadFiles` and `downloadFiles` methods I added are NOT part of the abstract interface.

**Impact**: These methods are optional convenience methods for cloud sandboxes. They work fine but aren't required by the protocol.

**Decision**: Keep the methods since they're useful and tested, but document them as optional conveniences.

### 2. ExecuteResponse Type Mismatch
**Finding**: The `ExecuteResponse` type uses `exitCode` (camelCase), not `exit_code` (snake_case).

**Fix**: Change all `exit_code` to `exitCode` in backend implementations.

### 3. E2B SDK API Different Than Plan
**Finding**: The E2B SDK (`@e2b/code-interpreter`) has a different API than what was documented in the plan:
- `Sandbox.create()` takes `template` as first positional arg, not in options
- No `process.start()` method - need to check actual API
- No `reconnect()` method - SDK is different

**Action Required**: Need to check actual E2B SDK API and adjust implementation.

### 4. Missing Type Imports
**Finding**: `FileUploadResponse` and `FileDownloadResponse` types don't exist in `../types`.

**Fix**: Define these types locally in each backend file or in a shared location.

### 5. Modal Requires Async Factory Pattern
**Finding**: Modal's SDK requires async operations (app creation, sandbox creation) which can't be done in a synchronous constructor.

**Current State**: Created `createModalBackend()` async factory function, but tests try to use `new ModalBackend()` which is now private.

**Fix Needed**: Update tests to use `createModalBackend()` instead of `new ModalBackend()`.

## Next Steps

1. **Fix E2B implementation** - Check actual SDK API
2. **Fix type issues** - Define missing types, fix `exitCode` vs `exit_code`
3. **Fix Modal tests** - Update tests to use async factory
4. **Verify Runloop/Daytona APIs** - May have similar discrepancies
5. **Re-run tests** - Verify all implementations work

## Files Affected
- `src/backends/e2b.ts`
- `src/backends/modal.ts`
- `src/backends/runloop.ts`
- `src/backends/daytona.ts`
- `test-integration/backends/sandbox-providers.test.ts`
